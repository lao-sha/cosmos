# Stardust é“¾å®‰å…¨å®¡è®¡æŠ¥å‘Š

**å®¡è®¡æ—¥æœŸ**: 2026-01-22  
**å®¡è®¡èŒƒå›´**: å…¨éƒ¨ Substrate Pallets  
**é£é™©ç­‰çº§**: ğŸ”´ ä¸¥é‡ | ğŸŸ  é«˜ | ğŸŸ¡ ä¸­ | ğŸŸ¢ ä½

---

## ç›®å½•

1. [æ‰§è¡Œæ‘˜è¦](#æ‰§è¡Œæ‘˜è¦)
2. [ä¸¥é‡é£é™© (Critical)](#ä¸¥é‡é£é™©-critical)
3. [é«˜é£é™© (High)](#é«˜é£é™©-high)
4. [ä¸­é£é™© (Medium)](#ä¸­é£é™©-medium)
5. [ä½é£é™© (Low)](#ä½é£é™©-low)
6. [æ¶æ„å»ºè®®](#æ¶æ„å»ºè®®)
7. [å·²å®æ–½çš„å®‰å…¨æªæ–½](#å·²å®æ–½çš„å®‰å…¨æªæ–½)

---

## æ‰§è¡Œæ‘˜è¦

æœ¬æ¬¡å®¡è®¡è¦†ç›–äº† Stardust é“¾çš„æ ¸å¿ƒä¸šåŠ¡æ¨¡å—ï¼ŒåŒ…æ‹¬ï¼š
- **äº¤æ˜“ç³»ç»Ÿ**: OTCã€Makerã€Swapã€Credit
- **ä»²è£ç³»ç»Ÿ**: Arbitrationã€Evidence
- **éšç§ç³»ç»Ÿ**: TEE-Privacyã€Divination-Privacy
- **è”ç›Ÿè®¡é…¬**: Affiliate
- **å­˜å‚¨ç³»ç»Ÿ**: Stardust-IPFS

**å‘ç°ç»Ÿè®¡**:
| é£é™©ç­‰çº§ | æ•°é‡ |
|---------|------|
| ğŸ”´ ä¸¥é‡ | 3 |
| ğŸŸ  é«˜ | 8 |
| ğŸŸ¡ ä¸­ | 12 |
| ğŸŸ¢ ä½ | 6 |


---

## ä¸¥é‡é£é™© (Critical)

### C-1: TRC20 éªŒè¯ç»•è¿‡é£é™© (pallet-swap)

**ä½ç½®**: `pallets/trading/swap/src/lib.rs`

**é—®é¢˜æè¿°**:
åšå¸‚å•†æäº¤ TRC20 äº¤æ˜“å“ˆå¸Œåï¼Œç³»ç»Ÿè¿›å…¥ `AwaitingVerification` çŠ¶æ€ç­‰å¾… OCW éªŒè¯ã€‚ä½†å­˜åœ¨ä»¥ä¸‹é£é™©ï¼š

1. **OCW éªŒè¯è¶…æ—¶åè‡ªåŠ¨è¿›å…¥ä»²è£**ï¼Œä½†ä»²è£æœŸé—´ DUST ä»è¢«é”å®š
2. **éªŒè¯å¤±è´¥åçŠ¶æ€ä¸º `VerificationFailed`**ï¼Œä½†æ²¡æœ‰è‡ªåŠ¨é€€æ¬¾æœºåˆ¶
3. **äº¤æ˜“å“ˆå¸Œå»é‡ä»…æ£€æŸ¥æœ¬åœ°å­˜å‚¨**ï¼ŒæœªéªŒè¯é“¾ä¸Šå®é™…äº¤æ˜“

**æ”»å‡»åœºæ™¯**:
```
1. åšå¸‚å•†æäº¤è™šå‡ TRC20 äº¤æ˜“å“ˆå¸Œ
2. OCW éªŒè¯å¤±è´¥æˆ–è¶…æ—¶
3. ç”¨æˆ· DUST è¢«é•¿æœŸé”å®šåœ¨æ‰˜ç®¡ä¸­
4. åšå¸‚å•†æ— æŸå¤±ï¼ˆæœªå®é™…è½¬è´¦ USDTï¼‰
```

**å»ºè®®ä¿®å¤**:
```rust
// åœ¨ VerificationFailed çŠ¶æ€ä¸‹è‡ªåŠ¨é€€æ¬¾
if record.status == SwapStatus::VerificationFailed {
    // è‡ªåŠ¨é€€æ¬¾ç»™ç”¨æˆ·
    T::Escrow::refund_all(swap_id, &record.user)?;
    // æ‰£é™¤åšå¸‚å•†ä¿¡ç”¨åˆ†
    T::Credit::record_maker_order_timeout(record.maker_id, swap_id);
}
```

**é£é™©ç­‰çº§**: ğŸ”´ ä¸¥é‡  
**å½±å“**: ç”¨æˆ·èµ„é‡‘å¯èƒ½è¢«é•¿æœŸé”å®š

---

### C-2: æŠ¼é‡‘è®¡ç®—æ•´æ•°æº¢å‡º (pallet-arbitration)

**ä½ç½®**: `pallets/arbitration/src/lib.rs:960-965`

**é—®é¢˜æè¿°**:
```rust
let deposit_amount = sp_runtime::Perbill::from_parts((deposit_ratio_bps as u32) * 100)
    .mul_floor(order_amount);
```

å½“ `deposit_ratio_bps = 10000` (100%) æ—¶ï¼Œ`(10000 as u32) * 100 = 1_000_000`ï¼Œè¶…è¿‡ `Perbill::from_parts` çš„æœ‰æ•ˆèŒƒå›´ (0-1_000_000_000)ã€‚

**æ”»å‡»åœºæ™¯**:
```
1. æ²»ç†è®¾ç½® DepositRatioBps = 10000
2. æŠ¼é‡‘è®¡ç®—ç»“æœå¼‚å¸¸ï¼ˆå¯èƒ½ä¸º0æˆ–æº¢å‡ºï¼‰
3. ç”¨æˆ·å¯ä»¥æ— æŠ¼é‡‘å‘èµ·ä»²è£
```

**å»ºè®®ä¿®å¤**:
```rust
// ä½¿ç”¨ Permill æˆ–æ·»åŠ è¾¹ç•Œæ£€æŸ¥
ensure!(deposit_ratio_bps <= 10000, Error::<T>::InvalidDepositRatio);
let deposit_amount = sp_runtime::Permill::from_parts((deposit_ratio_bps as u32) * 100)
    .mul_floor(order_amount);
```

**é£é™©ç­‰çº§**: ğŸ”´ ä¸¥é‡  
**å½±å“**: ä»²è£æŠ¼é‡‘æœºåˆ¶å¯èƒ½å¤±æ•ˆ

---

### C-3: TEE ç­¾åéªŒè¯æœªå®ç° (pallet-tee-privacy)

**ä½ç½®**: `pallets/divination/tee-privacy/src/lib.rs:700-702`

**é—®é¢˜æè¿°**:
```rust
// TODO: Phase 4 å°†éªŒè¯ Enclave ç­¾å
// Self::verify_enclave_signature(&who, &output_hash, &enclave_signature)?;
```

TEE è®¡ç®—ç»“æœæäº¤æ—¶ï¼ŒEnclave ç­¾åéªŒè¯è¢«æ³¨é‡Šæ‰ï¼Œä»»ä½•äººéƒ½å¯ä»¥æäº¤è™šå‡è®¡ç®—ç»“æœã€‚

**æ”»å‡»åœºæ™¯**:
```
1. æ¶æ„èŠ‚ç‚¹æ³¨å†Œä¸º TEE èŠ‚ç‚¹
2. æäº¤è™šå‡è®¡ç®—ç»“æœï¼ˆæ— éœ€çœŸå® TEE ç¯å¢ƒï¼‰
3. ç”¨æˆ·æ”¶åˆ°é”™è¯¯çš„å åœç»“æœ
4. æ¶æ„èŠ‚ç‚¹è·å¾—è®¡ç®—å¥–åŠ±
```

**å»ºè®®ä¿®å¤**:
```rust
// å¿…é¡»å®ç°ç­¾åéªŒè¯
fn verify_enclave_signature(
    node: &T::AccountId,
    output_hash: &[u8; 32],
    signature: &[u8; 64],
) -> DispatchResult {
    let node_info = TeeNodes::<T>::get(node).ok_or(Error::<T>::NodeNotRegistered)?;
    // ä½¿ç”¨ Ed25519 éªŒè¯ç­¾å
    ensure!(
        sp_io::crypto::ed25519_verify(
            &sp_core::ed25519::Signature::from_raw(*signature),
            output_hash,
            &sp_core::ed25519::Public::from_raw(node_info.enclave_pubkey),
        ),
        Error::<T>::InvalidEnclaveSignature
    );
    Ok(())
}
```

**é£é™©ç­‰çº§**: ğŸ”´ ä¸¥é‡  
**å½±å“**: TEE éšç§è®¡ç®—å®Œå…¨ä¸å¯ä¿¡


---

## é«˜é£é™© (High)

### H-1: åšå¸‚å•†æŠ¼é‡‘ä¸è¶³æ—¶ä»å¯æ¥å• (pallet-maker)

**ä½ç½®**: `pallets/trading/maker/src/lib.rs`

**é—®é¢˜æè¿°**:
åšå¸‚å•†æŠ¼é‡‘ä»·å€¼æ£€æŸ¥ä»…åœ¨ `on_idle` ä¸­æ‰§è¡Œï¼Œä¸æ˜¯å®æ—¶æ£€æŸ¥ã€‚å½“ DUST ä»·æ ¼ä¸‹è·Œæ—¶ï¼Œåšå¸‚å•†æŠ¼é‡‘ USD ä»·å€¼å¯èƒ½ä½äºé˜ˆå€¼ï¼Œä½†ä»å¯ç»§ç»­æ¥å•ã€‚

**å»ºè®®ä¿®å¤**:
åœ¨ OTC è®¢å•åˆ›å»ºæ—¶æ·»åŠ å®æ—¶æŠ¼é‡‘æ£€æŸ¥ï¼š
```rust
// pallet-otc: do_create_order
let maker_deposit_usd = T::MakerPallet::get_deposit_usd_value(maker_id)?;
ensure!(
    maker_deposit_usd >= T::MinDepositUsd::get(),
    Error::<T>::MakerDepositInsufficient
);
```

**é£é™©ç­‰çº§**: ğŸŸ  é«˜

---

### H-2: ä¿¡ç”¨åˆ†æ“çºµé£é™© (pallet-credit)

**ä½ç½®**: `pallets/trading/credit/src/lib.rs`

**é—®é¢˜æè¿°**:
1. **å¿«é€Ÿå­¦ä¹ æœºåˆ¶** (å‰3ç¬”5xæƒé‡) å¯è¢«åˆ©ç”¨
2. **ç¤¾äº¤ä¿¡ä»»** å¯é€šè¿‡åˆ›å»ºå¤šä¸ªè´¦æˆ·äº’ç›¸èƒŒä¹¦
3. **é£é™©åˆ†è¡°å‡** å¯èƒ½å¯¼è‡´æ¶æ„ç”¨æˆ·æ¢å¤ä¿¡ç”¨

**æ”»å‡»åœºæ™¯**:
```
1. åˆ›å»ºå¤šä¸ªè´¦æˆ· A, B, C
2. A ä¸º B èƒŒä¹¦ï¼ŒB ä¸º C èƒŒä¹¦
3. C è·å¾—é«˜ç¤¾äº¤ä¿¡ä»»åˆ†
4. C å®Œæˆ3ç¬”å°é¢è®¢å•è·å¾—5xä¿¡ç”¨åŠ æˆ
5. C è¿›è¡Œå¤§é¢æ¬ºè¯ˆåå¼ƒç”¨è´¦æˆ·
```

**å»ºè®®ä¿®å¤**:
```rust
// 1. èƒŒä¹¦è€…å¿…é¡»æœ‰è¶³å¤Ÿå†å²è®¢å•
ensure!(
    BuyerCredits::<T>::get(&endorser).completed_orders >= 10,
    Error::<T>::InsufficientHistoryToEndorse
);

// 2. é™åˆ¶èƒŒä¹¦é“¾æ·±åº¦
let endorser_endorsements = BuyerEndorsements::<T>::get(&endorser);
ensure!(
    endorser_endorsements.len() < 3,
    Error::<T>::EndorsementChainTooDeep
);

// 3. å¿«é€Ÿå­¦ä¹ ä»…é€‚ç”¨äºé¦–è´­ç”¨æˆ·
ensure!(
    HasFirstPurchased::<T>::get(&buyer),
    Error::<T>::FastLearningRequiresFirstPurchase
);
```

**é£é™©ç­‰çº§**: ğŸŸ  é«˜

---

### H-3: ä»²è£æŠ¼é‡‘ä»æ‰˜ç®¡æ‰£é™¤é£é™© (pallet-arbitration)

**ä½ç½®**: `pallets/arbitration/src/lib.rs:960-980`

**é—®é¢˜æè¿°**:
ä»²è£æŠ¼é‡‘ä»æ‰˜ç®¡è´¦æˆ·æ‰£é™¤ï¼Œè€Œéä»å½“äº‹äººè´¦æˆ·æ‰£é™¤ï¼š
```rust
let escrow_account = Self::get_escrow_account();
T::Fungible::hold(
    &T::RuntimeHoldReason::from(HoldReason::DisputeInitiator),
    &escrow_account,  // ä»æ‰˜ç®¡è´¦æˆ·æ‰£é™¤ï¼
    deposit_amount,
)?;
```

è¿™æ„å‘³ç€ï¼š
1. å‘èµ·ä»²è£ä¸éœ€è¦å½“äº‹äººæœ‰é¢å¤–èµ„é‡‘
2. æŠ¼é‡‘å®é™…æ¥è‡ªè®¢å•æ‰˜ç®¡é‡‘é¢
3. å¦‚æœæ‰˜ç®¡é‡‘é¢ä¸è¶³ï¼Œä»²è£æ— æ³•å‘èµ·

**å»ºè®®ä¿®å¤**:
åº”ä»å½“äº‹äººè´¦æˆ·æ‰£é™¤æŠ¼é‡‘ï¼Œè€Œéæ‰˜ç®¡è´¦æˆ·ï¼š
```rust
T::Fungible::hold(
    &T::RuntimeHoldReason::from(HoldReason::DisputeInitiator),
    &initiator,  // ä»å‘èµ·äººè´¦æˆ·æ‰£é™¤
    deposit_amount,
)?;
```

**é£é™©ç­‰çº§**: ğŸŸ  é«˜

---

### H-4: æ²»ç†ææ¡ˆæŠ¼é‡‘å›ºå®šå€¼é£é™© (pallet-affiliate)

**ä½ç½®**: `pallets/divination/affiliate/src/lib.rs:850`

**é—®é¢˜æè¿°**:
```rust
let deposit_amount = 5000u128.saturated_into();
```

ææ¡ˆæŠ¼é‡‘å›ºå®šä¸º 5000 DUSTï¼Œä¸éš DUST ä»·æ ¼å˜åŒ–ã€‚å½“ DUST ä»·æ ¼ä¸Šæ¶¨æ—¶ï¼Œææ¡ˆæˆæœ¬è¿‡é«˜ï¼›ä»·æ ¼ä¸‹è·Œæ—¶ï¼Œåƒåœ¾ææ¡ˆæˆæœ¬è¿‡ä½ã€‚

**å»ºè®®ä¿®å¤**:
```rust
// ä½¿ç”¨ USD è®¡ä»·çš„æŠ¼é‡‘
let target_usd = 50_000_000u64; // 50 USD
let dust_price = T::Pricing::get_dust_to_usd_rate()?;
let deposit_amount = target_usd * 1_000_000_000_000 / dust_price;
```

**é£é™©ç­‰çº§**: ğŸŸ  é«˜

---

### H-5: è¯æ® CID æœªéªŒè¯åŠ å¯†çŠ¶æ€ (pallet-evidence)

**ä½ç½®**: `pallets/evidence/src/lib.rs:580-590`

**é—®é¢˜æè¿°**:
ç§å¯†å†…å®¹å­˜å‚¨æ—¶éªŒè¯äº† CID åŠ å¯†çŠ¶æ€ï¼š
```rust
ensure!(
    crate::cid_validator::DefaultCidValidator::is_encrypted(cid_bytes),
    Error::<T>::InvalidCidFormat
);
```

ä½†æ™®é€šè¯æ®æäº¤ (`commit`) æ²¡æœ‰æ­¤éªŒè¯ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯ä»¥æ˜æ–‡å½¢å¼å­˜å‚¨ã€‚

**å»ºè®®ä¿®å¤**:
æ ¹æ® `privacy_mode` å¼ºåˆ¶éªŒè¯ CID åŠ å¯†çŠ¶æ€ã€‚

**é£é™©ç­‰çº§**: ğŸŸ  é«˜

---

### H-6: é¦–è´­è®¢å•åšå¸‚å•†é€‰æ‹©æ— éšæœºæ€§ (pallet-otc)

**ä½ç½®**: `pallets/trading/otc/src/lib.rs`

**é—®é¢˜æè¿°**:
é¦–è´­è®¢å•ç”±ä¹°å®¶æŒ‡å®šåšå¸‚å•†ï¼Œæ²¡æœ‰éšæœºåˆ†é…æœºåˆ¶ã€‚æ¶æ„åšå¸‚å•†å¯ä»¥ï¼š
1. åˆ›å»ºå¤šä¸ªè´¦æˆ·è¿›è¡Œé¦–è´­
2. æŒ‡å®šè‡ªå·±ä¸ºåšå¸‚å•†
3. è·å¾—é¦–è´­è®¢å•çš„ä¼˜æƒ æ¡ä»¶

**å»ºè®®ä¿®å¤**:
é¦–è´­è®¢å•åº”éšæœºåˆ†é…åšå¸‚å•†ï¼Œæˆ–ä½¿ç”¨è½®è¯¢æœºåˆ¶ã€‚

**é£é™©ç­‰çº§**: ğŸŸ  é«˜

---

### H-7: å‘¨ç»“ç®—è´¦æˆ·åˆ—è¡¨æ— ç•Œ (pallet-affiliate)

**ä½ç½®**: `pallets/divination/affiliate/src/lib.rs`

**é—®é¢˜æè¿°**:
```rust
pub type CycleAccounts<T: Config> = StorageMap<
    _,
    Twox64Concat,
    u32,  // cycle
    BoundedVec<T::AccountId, ConstU32<1000>>,  // é™åˆ¶1000
    ValueQuery,
>;
```

è™½ç„¶æœ‰ 1000 çš„é™åˆ¶ï¼Œä½†å¦‚æœè¶…è¿‡ 1000 ä¸ªè´¦æˆ·éœ€è¦ç»“ç®—ï¼Œéƒ¨åˆ†è´¦æˆ·å°†æ— æ³•è·å¾—åˆ†æˆã€‚

**å»ºè®®ä¿®å¤**:
å®ç°åˆ†é¡µç»“ç®—æœºåˆ¶ï¼Œç¡®ä¿æ‰€æœ‰è´¦æˆ·éƒ½èƒ½è·å¾—åˆ†æˆã€‚

**é£é™©ç­‰çº§**: ğŸŸ  é«˜

---

### H-8: äº‰è®®è¯æ® CID æœªè‡ªåŠ¨ PIN (pallet-otc)

**ä½ç½®**: `pallets/trading/otc/src/lib.rs`

**é—®é¢˜æè¿°**:
OTC äº‰è®®ä¸­çš„ `evidence_cid` å­—æ®µå­˜å‚¨äº†è¯æ® CIDï¼Œä½†æ²¡æœ‰è°ƒç”¨ IPFS PIN æœºåˆ¶ã€‚è¯æ®å¯èƒ½åœ¨ä»²è£æœŸé—´è¢«åˆ é™¤ã€‚

**å»ºè®®ä¿®å¤**:
```rust
// åœ¨ do_initiate_dispute ä¸­
if let Some(ref cid) = evidence_cid {
    let cid_hash = sp_core::blake2_256(cid.as_slice());
    T::CidLockManager::lock_cid(
        T::Hash::from(cid_hash),
        b"otc_dispute".to_vec(),
        None,
    )?;
}
```

**é£é™©ç­‰çº§**: ğŸŸ  é«˜


---

## ä¸­é£é™© (Medium)

### M-1: TRON äº¤æ˜“å“ˆå¸Œ TTL æ¸…ç†æœªå®ç° (pallet-swap)

**ä½ç½®**: `pallets/trading/swap/src/lib.rs`

**é—®é¢˜æè¿°**:
`UsedTronTxHashes` å­˜å‚¨äº†åŒºå—å·ç”¨äº TTL æ¸…ç†ï¼Œä½† `on_idle` ä¸­æ²¡æœ‰å®ç°æ¸…ç†é€»è¾‘ã€‚é•¿æœŸè¿è¡Œä¼šå¯¼è‡´å­˜å‚¨è†¨èƒ€ã€‚

**å»ºè®®ä¿®å¤**:
```rust
fn on_idle(now: BlockNumberFor<T>, remaining_weight: Weight) -> Weight {
    let ttl = T::TxHashTtlBlocks::get();
    let cursor = TxHashCleanupCursor::<T>::get();
    // æ¸…ç†è¿‡æœŸçš„äº¤æ˜“å“ˆå¸Œ
    for (hash, recorded_at) in UsedTronTxHashes::<T>::iter() {
        if now.saturating_sub(recorded_at) > ttl {
            UsedTronTxHashes::<T>::remove(&hash);
        }
    }
}
```

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­

---

### M-2: åšå¸‚å•†æƒ©ç½šè®°å½•å½’æ¡£å»¶è¿Ÿè¿‡é•¿ (pallet-maker)

**ä½ç½®**: `pallets/trading/maker/src/lib.rs`

**é—®é¢˜æè¿°**:
æƒ©ç½šè®°å½•å½’æ¡£å»¶è¿Ÿä¸º 30 å¤© (`30 * 14400` åŒºå—)ï¼Œä½†ç”³è¯‰æœŸé™ä¸º 7 å¤©ã€‚è¿™æ„å‘³ç€å·²è¿‡ç”³è¯‰æœŸçš„è®°å½•ä»å ç”¨å­˜å‚¨ 23 å¤©ã€‚

**å»ºè®®ä¿®å¤**:
å°†å½’æ¡£å»¶è¿Ÿæ”¹ä¸ºç”³è¯‰æœŸé™ + ç¼“å†²æœŸ (å¦‚ 10 å¤©)ã€‚

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­

---

### M-3: æˆæƒè¿‡æœŸæ£€æŸ¥ç¼ºå¤± (pallet-divination-privacy)

**ä½ç½®**: `pallets/divination/privacy/src/lib.rs`

**é—®é¢˜æè¿°**:
`AuthorizationEntry` æœ‰ `expires_at` å­—æ®µï¼Œä½†æ²¡æœ‰åœ¨è®¿é—®æ—¶æ£€æŸ¥æ˜¯å¦è¿‡æœŸã€‚è¿‡æœŸæˆæƒä»å¯ä½¿ç”¨ã€‚

**å»ºè®®ä¿®å¤**:
```rust
fn check_authorization(
    divination_type: DivinationType,
    result_id: u64,
    grantee: &T::AccountId,
) -> Result<AuthorizationEntry<...>, Error<T>> {
    let auth = Authorizations::<T>::get((divination_type, result_id, grantee))
        .ok_or(Error::<T>::AuthorizationNotFound)?;
    
    let now = frame_system::Pallet::<T>::block_number();
    ensure!(
        auth.expires_at.is_zero() || now <= auth.expires_at,
        Error::<T>::AuthorizationExpired
    );
    
    Ok(auth)
}
```

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­

---

### M-4: TEE èŠ‚ç‚¹è®¤è¯è¿‡æœŸæœªè‡ªåŠ¨å¤„ç† (pallet-tee-privacy)

**ä½ç½®**: `pallets/divination/tee-privacy/src/lib.rs`

**é—®é¢˜æè¿°**:
TEE èŠ‚ç‚¹è®¤è¯æœ‰æ•ˆæœŸä¸º 24 å°æ—¶ (`ATTESTATION_VALIDITY_BLOCKS = 14400`)ï¼Œä½†æ²¡æœ‰è‡ªåŠ¨æ£€æŸ¥å’Œå¤„ç†è¿‡æœŸèŠ‚ç‚¹çš„æœºåˆ¶ã€‚

**å»ºè®®ä¿®å¤**:
åœ¨ `on_idle` ä¸­æ£€æŸ¥å¹¶æš‚åœè®¤è¯è¿‡æœŸçš„èŠ‚ç‚¹ã€‚

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­

---

### M-5: ä¹°å®¶é¢åº¦å ç”¨æœªè€ƒè™‘è®¢å•è¶…æ—¶ (pallet-otc)

**ä½ç½®**: `pallets/trading/otc/src/lib.rs`

**é—®é¢˜æè¿°**:
è®¢å•åˆ›å»ºæ—¶å ç”¨ä¹°å®¶é¢åº¦ï¼Œä½†è®¢å•è¶…æ—¶è‡ªåŠ¨å–æ¶ˆæ—¶ï¼Œé¢åº¦é‡Šæ”¾é€»è¾‘åœ¨ `process_expired_orders` ä¸­å¯èƒ½ä¸å®Œæ•´ã€‚

**å»ºè®®ä¿®å¤**:
ç¡®ä¿ `process_expired_orders` ä¸­è°ƒç”¨ `T::Credit::release_quota`ã€‚

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­

---

### M-6: æŠ•è¯‰ç±»å‹ä¸åŸŸä¸åŒ¹é…æ£€æŸ¥ä¸ä¸¥æ ¼ (pallet-arbitration)

**ä½ç½®**: `pallets/arbitration/src/lib.rs:1130`

**é—®é¢˜æè¿°**:
```rust
ensure!(
    complaint_type.domain() == domain || matches!(complaint_type, ComplaintType::Other),
    Error::<T>::InvalidComplaintType
);
```

`ComplaintType::Other` å¯ä»¥ç”¨äºä»»ä½•åŸŸï¼Œå¯èƒ½å¯¼è‡´æŠ•è¯‰åˆ†ç±»æ··ä¹±ã€‚

**å»ºè®®ä¿®å¤**:
ç§»é™¤ `Other` ç±»å‹çš„ç‰¹æ®Šå¤„ç†ï¼Œæˆ–é™åˆ¶å…¶ä½¿ç”¨åœºæ™¯ã€‚

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­

---

### M-7: åšå¸‚å•†æœåŠ¡æš‚åœçŠ¶æ€æ£€æŸ¥ä¸ä¸€è‡´ (pallet-maker)

**ä½ç½®**: `pallets/trading/maker/src/lib.rs`

**é—®é¢˜æè¿°**:
`MakerApplication` æœ‰ `service_paused` å­—æ®µï¼Œä½† OTC è®¢å•åˆ›å»ºæ—¶åªæ£€æŸ¥ `is_active`ï¼Œæœªæ£€æŸ¥ `service_paused`ã€‚

**å»ºè®®ä¿®å¤**:
```rust
ensure!(maker_app.is_active && !maker_app.service_paused, Error::<T>::MakerNotActive);
```

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­

---

### M-8: ä¿¡ç”¨åˆ†æ¢å¤æœºåˆ¶å¯è¢«åˆ©ç”¨ (pallet-credit)

**ä½ç½®**: `pallets/trading/credit/src/lib.rs`

**é—®é¢˜æè¿°**:
ä¿¡ç”¨æ¢å¤æœºåˆ¶ (30å¤©æ— è¿çº¦æˆ–10å•å¥–åŠ±) å¯èƒ½è¢«åˆ©ç”¨ï¼š
1. è¿çº¦åç­‰å¾… 30 å¤©è‡ªåŠ¨æ¢å¤
2. å®Œæˆ 10 ç¬”å°é¢è®¢å•å¿«é€Ÿæ¢å¤

**å»ºè®®ä¿®å¤**:
- æ¢å¤åè®¾ç½®è§‚å¯ŸæœŸ
- æ¢å¤å¹…åº¦ä¸è¿çº¦ä¸¥é‡ç¨‹åº¦æŒ‚é’©

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­

---

### M-9: æ‚¬èµæˆæƒè‡ªåŠ¨æˆæƒé£é™© (pallet-divination-privacy)

**ä½ç½®**: `pallets/divination/privacy/src/lib.rs`

**é—®é¢˜æè¿°**:
`BountyAuthInfo` æœ‰ `auto_authorize` å­—æ®µï¼Œå¦‚æœè®¾ç½®ä¸º trueï¼Œä»»ä½•å›ç­”è€…éƒ½ä¼šè‡ªåŠ¨è·å¾—æˆæƒã€‚è¿™å¯èƒ½å¯¼è‡´æ•æ„Ÿæ•°æ®æ³„éœ²ã€‚

**å»ºè®®ä¿®å¤**:
è‡ªåŠ¨æˆæƒåº”ä»…é™äºç‰¹å®šè§’è‰²æˆ–ç»è¿‡éªŒè¯çš„å›ç­”è€…ã€‚

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­

---

### M-10: å‘¨ç»“ç®—æ¸¸æ ‡æœªé‡ç½® (pallet-affiliate)

**ä½ç½®**: `pallets/divination/affiliate/src/lib.rs`

**é—®é¢˜æè¿°**:
`SettleCursor` è®°å½•ç»“ç®—è¿›åº¦ï¼Œä½†å‘¨æœŸç»“æŸåæœªé‡ç½®ï¼Œå¯èƒ½å¯¼è‡´ä¸‹ä¸€å‘¨æœŸç»“ç®—å¼‚å¸¸ã€‚

**å»ºè®®ä¿®å¤**:
åœ¨å‘¨æœŸç»“æŸæ—¶æ¸…ç† `SettleCursor`ã€‚

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­

---

### M-11: è¯æ®æ•°é‡é™åˆ¶å¯èƒ½ä¸è¶³ (pallet-evidence)

**ä½ç½®**: `pallets/evidence/src/lib.rs`

**é—®é¢˜æè¿°**:
æ¯ä¸ªä¸»ä½“æœ€å¤š `MaxPerSubjectTarget` æ¡è¯æ®ï¼Œä½†æ²¡æœ‰å…¨å±€é™åˆ¶ã€‚æ¶æ„ç”¨æˆ·å¯ä»¥åˆ›å»ºå¤§é‡ä¸»ä½“æ¥å­˜å‚¨è¯æ®ã€‚

**å»ºè®®ä¿®å¤**:
æ·»åŠ æ¯è´¦æˆ·å…¨å±€è¯æ®æ•°é‡é™åˆ¶ã€‚

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­

---

### M-12: æŠ•ç¥¨é”å®šè§£é”æ—¶æœºä¸æ˜ç¡® (pallet-affiliate)

**ä½ç½®**: `pallets/divination/affiliate/src/lib.rs`

**é—®é¢˜æè¿°**:
`VoteLocks` å­˜å‚¨æŠ•ç¥¨é”å®šè®°å½•ï¼Œä½†æ²¡æœ‰æ˜ç¡®çš„è§£é”æœºåˆ¶ã€‚

**å»ºè®®ä¿®å¤**:
åœ¨ææ¡ˆç»“æŸåè‡ªåŠ¨è§£é”æŠ•ç¥¨é”å®šã€‚

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­


---

## ä½é£é™© (Low)

### L-1: äº‹ä»¶ä¸­ domain å­—æ®µç¡¬ç¼–ç ä¸ºé›¶ (pallet-arbitration)

**ä½ç½®**: `pallets/arbitration/src/lib.rs:1500`

**é—®é¢˜æè¿°**:
```rust
Self::deposit_event(Event::DepositProcessed {
    domain: [0u8; 8], // ç®€åŒ–å¤„ç†ï¼Œå®é™…åº”ä¼ å…¥domain
    id: 0,
    ...
});
```

äº‹ä»¶ä¸­çš„ domain å’Œ id è¢«ç¡¬ç¼–ç ï¼Œå½±å“é“¾ä¸‹ç´¢å¼•å’Œç›‘æ§ã€‚

**é£é™©ç­‰çº§**: ğŸŸ¢ ä½

---

### L-2: å½’æ¡£ç»Ÿè®¡ bytes_saved æœªå®é™…è®¡ç®— (pallet-evidence)

**ä½ç½®**: `pallets/evidence/src/lib.rs`

**é—®é¢˜æè¿°**:
`ArchiveStatistics.bytes_saved` å­—æ®µå­˜åœ¨ä½†æœªè¢«æ›´æ–°ï¼Œæ— æ³•å‡†ç¡®åæ˜ å­˜å‚¨èŠ‚çœã€‚

**é£é™©ç­‰çº§**: ğŸŸ¢ ä½

---

### L-3: åšå¸‚å•†è„±æ•ä¿¡æ¯é•¿åº¦é™åˆ¶ä¸ä¸€è‡´ (pallet-maker)

**ä½ç½®**: `pallets/trading/maker/src/lib.rs`

**é—®é¢˜æè¿°**:
- `masked_full_name`: 64 å­—èŠ‚
- `masked_id_card`: 32 å­—èŠ‚
- `masked_birthday`: 16 å­—èŠ‚

è¿™äº›é™åˆ¶å¯èƒ½ä¸è¶³ä»¥æ”¯æŒæŸäº›å›½å®¶çš„å§“åæ ¼å¼ã€‚

**é£é™©ç­‰çº§**: ğŸŸ¢ ä½

---

### L-4: æŠ•è¯‰å½’æ¡£å»¶è¿Ÿè¿‡é•¿ (pallet-arbitration)

**ä½ç½®**: `pallets/arbitration/src/lib.rs:1600`

**é—®é¢˜æè¿°**:
æŠ•è¯‰å½’æ¡£å»¶è¿Ÿä¸º 30 å¤© (`432000` åŒºå—)ï¼Œå¯èƒ½å¯¼è‡´å­˜å‚¨å ç”¨è¿‡é«˜ã€‚

**å»ºè®®ä¿®å¤**:
è€ƒè™‘ç¼©çŸ­ä¸º 7-14 å¤©ã€‚

**é£é™©ç­‰çº§**: ğŸŸ¢ ä½

---

### L-5: ç”¨æˆ·å…¬é’¥æ›´æ–°æ— é€šçŸ¥æœºåˆ¶ (pallet-divination-privacy)

**ä½ç½®**: `pallets/divination/privacy/src/lib.rs`

**é—®é¢˜æè¿°**:
ç”¨æˆ·æ›´æ–°åŠ å¯†å…¬é’¥åï¼Œå·²æˆæƒçš„åŠ å¯†å¯†é’¥åŒ…éœ€è¦é‡æ–°åŠ å¯†ï¼Œä½†æ²¡æœ‰é€šçŸ¥æœºåˆ¶ã€‚

**é£é™©ç­‰çº§**: ğŸŸ¢ ä½

---

### L-6: åšå¸‚å•†é¦–è´­è®¢å•åˆ—è¡¨é™åˆ¶è¿‡å° (pallet-otc)

**ä½ç½®**: `pallets/trading/otc/src/lib.rs`

**é—®é¢˜æè¿°**:
```rust
BoundedVec<u64, ConstU32<10>>  // æœ€å¤š10ä¸ªé¦–è´­è®¢å•
```

å¦‚æœ `MaxFirstPurchaseOrdersPerMaker = 5`ï¼Œè¿™ä¸ªé™åˆ¶æ˜¯åˆç†çš„ã€‚ä½†å¦‚æœå¢åŠ é…é¢ï¼Œå¯èƒ½ä¸è¶³ã€‚

**é£é™©ç­‰çº§**: ğŸŸ¢ ä½

---

## æ¶æ„å»ºè®®

### 1. ç»Ÿä¸€é”™è¯¯å¤„ç†

å»ºè®®åˆ›å»ºç»Ÿä¸€çš„é”™è¯¯ç±»å‹æ¨¡å—ï¼Œé¿å…å„ pallet é‡å¤å®šä¹‰ç›¸ä¼¼é”™è¯¯ã€‚

### 2. è·¨ Pallet äº‹åŠ¡

OTC è®¢å•åˆ›å»ºæ¶‰åŠå¤šä¸ª pallet (Escrow, Credit, ChatPermission)ï¼Œå»ºè®®å®ç°äº‹åŠ¡å›æ»šæœºåˆ¶ã€‚

### 3. å­˜å‚¨è†¨èƒ€é˜²æŠ¤

å·²å®æ–½çš„å½’æ¡£æœºåˆ¶å¾ˆå¥½ï¼Œå»ºè®®ï¼š
- ç»Ÿä¸€å½’æ¡£ç­–ç•¥
- æ·»åŠ å­˜å‚¨ä½¿ç”¨ç›‘æ§
- å®ç°ç´§æ€¥æ¸…ç†æœºåˆ¶

### 4. ä»·æ ¼é¢„è¨€æœº

å½“å‰ä»·æ ¼æ¥è‡ª `PricingProvider`ï¼Œå»ºè®®ï¼š
- æ·»åŠ ä»·æ ¼æœ‰æ•ˆæœŸæ£€æŸ¥
- å®ç°å¤šæºä»·æ ¼èšåˆ
- æ·»åŠ ä»·æ ¼å¼‚å¸¸æ£€æµ‹

### 5. æƒé™åˆ†ç¦»

å»ºè®®å°†æ²»ç†æƒé™ç»†åˆ†ï¼š
- ç´§æ€¥æ“ä½œæƒé™
- é…ç½®æ›´æ–°æƒé™
- ä»²è£æƒé™


---

## å·²å®æ–½çš„å®‰å…¨æªæ–½

### âœ… å­˜å‚¨è†¨èƒ€é˜²æŠ¤

1. **å¤šçº§å½’æ¡£æœºåˆ¶**: L1 â†’ L2 å½’æ¡£ï¼Œé€æ­¥å‹ç¼©å­˜å‚¨
2. **on_idle æ¸…ç†**: åˆ©ç”¨ç©ºé—²æ—¶é—´æ¸…ç†è¿‡æœŸæ•°æ®
3. **BoundedVec é™åˆ¶**: æ‰€æœ‰åˆ—è¡¨éƒ½æœ‰ä¸Šé™

### âœ… èµ„é‡‘å®‰å…¨

1. **æ‰˜ç®¡æœºåˆ¶**: æ‰€æœ‰äº¤æ˜“èµ„é‡‘é€šè¿‡ pallet-escrow æ‰˜ç®¡
2. **æŠ¼é‡‘æœºåˆ¶**: ä¹°å®¶æŠ¼é‡‘ã€åšå¸‚å•†æŠ¼é‡‘ã€ä»²è£æŠ¼é‡‘
3. **ä¿¡ç”¨åˆ†ç³»ç»Ÿ**: å¤šç»´åº¦é£é™©è¯„ä¼°

### âœ… èº«ä»½éªŒè¯

1. **KYC é›†æˆ**: OTC äº¤æ˜“éœ€è¦ KYC è®¤è¯
2. **TEE è®¤è¯**: TEE èŠ‚ç‚¹éœ€è¦è¿œç¨‹è®¤è¯
3. **æœåŠ¡æä¾›è€…æ³¨å†Œ**: å‘½ç†å¸ˆéœ€è¦æ³¨å†Œ

### âœ… éšç§ä¿æŠ¤

1. **åŠ å¯†å­˜å‚¨**: æ•æ„Ÿæ•°æ® AES-256-GCM åŠ å¯†
2. **æˆæƒç®¡ç†**: å¤šæ–¹æˆæƒã€è§’è‰²æ§åˆ¶
3. **è„±æ•å¤„ç†**: åšå¸‚å•†ä¿¡æ¯è„±æ•æ˜¾ç¤º

### âœ… é˜²é‡æ”¾æ”»å‡»

1. **TRON äº¤æ˜“å“ˆå¸Œå»é‡**: é˜²æ­¢åŒä¸€ç¬”äº¤æ˜“é‡å¤ä½¿ç”¨
2. **æ‰¿è¯ºå“ˆå¸Œå”¯ä¸€ç´¢å¼•**: é˜²æ­¢è¯æ®é‡å¤æäº¤

### âœ… è¶…æ—¶ä¿æŠ¤

1. **è®¢å•è¶…æ—¶**: 1 å°æ—¶æœªæ”¯ä»˜è‡ªåŠ¨å–æ¶ˆ
2. **ä»²è£å“åº”è¶…æ—¶**: 7 å¤©æœªå“åº”è‡ªåŠ¨å¤„ç†
3. **TEE è¯·æ±‚è¶…æ—¶**: 10 åˆ†é’Ÿè¶…æ—¶æ•…éšœè½¬ç§»

---

## ä¿®å¤ä¼˜å…ˆçº§

| ä¼˜å…ˆçº§ | é—®é¢˜ç¼–å· | æè¿° |
|-------|---------|------|
| P0 | C-1 | TRC20 éªŒè¯ç»•è¿‡é£é™© |
| P0 | C-2 | æŠ¼é‡‘è®¡ç®—æ•´æ•°æº¢å‡º |
| P0 | C-3 | TEE ç­¾åéªŒè¯æœªå®ç° |
| P1 | H-1 | åšå¸‚å•†æŠ¼é‡‘å®æ—¶æ£€æŸ¥ |
| P1 | H-2 | ä¿¡ç”¨åˆ†æ“çºµé˜²æŠ¤ |
| P1 | H-3 | ä»²è£æŠ¼é‡‘æ¥æºä¿®æ­£ |
| P2 | H-4 ~ H-8 | å…¶ä»–é«˜é£é™©é—®é¢˜ |
| P3 | M-1 ~ M-12 | ä¸­é£é™©é—®é¢˜ |
| P4 | L-1 ~ L-6 | ä½é£é™©é—®é¢˜ |

---

## å®¡è®¡ç»“è®º

Stardust é“¾æ•´ä½“æ¶æ„è®¾è®¡åˆç†ï¼Œå·²å®æ–½å¤šé¡¹å®‰å…¨æªæ–½ã€‚ä½†å­˜åœ¨ 3 ä¸ªä¸¥é‡é£é™©å’Œ 8 ä¸ªé«˜é£é™©é—®é¢˜éœ€è¦ä¼˜å…ˆä¿®å¤ã€‚

**å»ºè®®**:
1. ç«‹å³ä¿®å¤ C-1, C-2, C-3 ä¸¥é‡é£é™©
2. åœ¨ä¸‹ä¸€ç‰ˆæœ¬ä¸­ä¿®å¤æ‰€æœ‰é«˜é£é™©é—®é¢˜
3. åˆ¶å®šä¸­é£é™©é—®é¢˜ä¿®å¤è®¡åˆ’
4. æŒç»­ç›‘æ§å’Œå®¡è®¡

---

*å®¡è®¡æŠ¥å‘Šç”± Kiro AI ç”Ÿæˆ*  
*å®¡è®¡æ—¥æœŸ: 2026-01-22*
