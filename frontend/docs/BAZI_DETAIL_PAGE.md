# 八字命理详情页面功能说明

## 概述

八字命理详情页面 (`bazi-detail.tsx`) 是一个完整的命理分析展示页面，提供专业的八字命盘解读和五行分析。

## 页面路由

- **路径**: `/divination/bazi-detail`
- **参数**: `data` (JSON 字符串格式的八字结果数据)
- **来源**: 从八字排盘页面 (`bazi.tsx`) 跳转

## 核心功能模块

### 1. 基本信息展示

显示用户的基础信息：
- 姓名
- 性别（男/女）
- 生肖
- 出生时间（年月日时）

### 2. 四柱八字详解

最核心的命理分析模块，包含：

#### 天干信息
- 天干字符（甲乙丙丁戊己庚辛壬癸）
- 五行属性（木火土金水）
- 阴阳属性（阳/阴）
- 十神关系（比肩、劫财、食神等）

#### 地支信息
- 地支字符（子丑寅卯辰巳午未申酉戌亥）
- 五行属性
- 阴阳属性
- 纳音五行

#### 藏干信息
地支中隐藏的天干，例如：
- 子藏癸
- 丑藏己、癸、乙
- 寅藏甲、丙
- 等等

### 3. 五行分析

#### 五行分布图表
- 木、火、土、金、水的数量统计
- 百分比可视化条形图
- 五行颜色标识：
  - 木：绿色 (#2E7D32)
  - 火：红色 (#C62828)
  - 土：橙色 (#F57C00)
  - 金：黄色 (#FDD835)
  - 水：蓝色 (#1565C0)

#### 缺失提示
- 标记五行中缺失的元素
- 显示"缺失"标签

### 4. 日主分析

日主是八字的核心，代表命主本人：
- 日柱天干（日主）
- 五行属性
- 阴阳属性
- 特殊标识（日主标签）

### 5. 十神分析

十神是八字命理的重要概念，表示天干之间的关系：

| 十神 | 含义 |
|------|------|
| 比肩 | 同性相助 |
| 劫财 | 异性相克 |
| 食神 | 泄秀气 |
| 伤官 | 克制官星 |
| 偏财 | 横财运 |
| 正财 | 正财运 |
| 七杀 | 克身之力 |
| 正官 | 官运 |
| 偏印 | 背禄 |
| 正印 | 生身之力 |

#### 计算方法
```typescript
const calculateShiShen = (ganIndex: number, dayMasterIndex: number): string => {
  const diff = (ganIndex - dayMasterIndex + 10) % 10;
  const shiShenList = ['比肩', '劫财', '食神', '伤官', '偏财', '正财', '七杀', '正官', '偏印', '正印'];
  return shiShenList[diff] || '未知';
};
```

### 6. 五行建议

根据五行分析提供补充建议：

#### 缺失元素
- 识别五行中完全缺失的元素（数量为 0）
- 提供补充建议：名字、穿衣、居住方向等

#### 弱势元素
- 识别五行中较弱的元素（数量为 1）
- 建议适当加强补充

## 数据结构

### 输入数据格式

```typescript
interface BaziResult {
  id: number;
  name: string;
  birthYear: number;
  birthMonth: number;
  birthDay: number;
  birthHour: number;
  gender: 'male' | 'female';
  siZhu: {
    year: { gan: number; zhi: number };
    month: { gan: number; zhi: number };
    day: { gan: number; zhi: number };
    hour: { gan: number; zhi: number };
  };
  wuxingCount: Record<string, number>;
  dayMaster: number;
  shengxiao: string;
  createdAt: Date;
}
```

### 藏干映射表

```typescript
const hiddenMap: Record<number, number[]> = {
  0: [9],           // 子 - 癸
  1: [5, 9, 1],     // 丑 - 己、癸、乙
  2: [3, 7],        // 寅 - 甲、丙
  3: [1, 5],        // 卯 - 乙、己
  4: [1, 5, 7],     // 辰 - 甲、戊、丙
  5: [7, 9, 5],     // 巳 - 丙、庚、戊
  6: [7, 9],        // 午 - 丙、己
  7: [5, 9, 1],     // 未 - 己、丁、乙
  8: [7, 9, 1],     // 申 - 庚、壬、甲
  9: [9, 5, 7],     // 酉 - 辛、己、丁
  10: [7, 5, 9],    // 戌 - 戊、辛、丙
  11: [9, 1],       // 亥 - 壬、甲
};
```

## UI 设计特点

### 主题色
- 主色调：金色 (#B2955D)
- 背景色：浅灰 (#F5F5F7)
- 卡片背景：白色 (#FFF)

### 布局特点
- 卡片式设计，每个功能模块独立
- 响应式布局，最大宽度 414px
- 圆角阴影效果，提升视觉层次
- 五行颜色标识，直观易懂

### 交互设计
- 顶部导航栏，支持返回
- 滚动查看完整内容
- 底部导航栏固定
- 无数据时显示空状态

## 使用示例

### 从八字排盘页面跳转

```typescript
import { useRouter } from 'expo-router';

const router = useRouter();

// 跳转到详情页
router.push({
  pathname: '/divination/bazi-detail',
  params: {
    data: JSON.stringify(baziResult)
  }
});
```

### 页面内获取数据

```typescript
const params = useLocalSearchParams();
const [result] = useState<BaziResult | null>(() => {
  if (params.data && typeof params.data === 'string') {
    try {
      return JSON.parse(params.data);
    } catch {
      return null;
    }
  }
  return null;
});
```

## 命理知识说明

### 天干地支

**天干**（10 个）：甲、乙、丙、丁、戊、己、庚、辛、壬、癸
- 阳干：甲、丙、戊、庚、壬
- 阴干：乙、丁、己、辛、癸

**地支**（12 个）：子、丑、寅、卯、辰、巳、午、未、申、酉、戌、亥
- 阳支：子、寅、辰、午、申、戌
- 阴支：丑、卯、巳、未、酉、亥

### 五行属性

| 五行 | 天干 | 地支 |
|------|------|------|
| 木 | 甲、乙 | 寅、卯 |
| 火 | 丙、丁 | 巳、午 |
| 土 | 戊、己 | 辰、戌、丑、未 |
| 金 | 庚、辛 | 申、酉 |
| 水 | 壬、癸 | 子、亥 |

### 四柱含义

- **年柱**：祖辈、父母、童年（0-16岁）
- **月柱**：父母、兄弟、青年（17-32岁）
- **日柱**：自己、配偶、中年（33-48岁）
- **时柱**：子女、晚年（49岁以后）

## 技术实现

### 核心算法

1. **十神计算**：基于日主天干与其他天干的关系
2. **藏干提取**：根据地支索引查找隐藏天干
3. **五行统计**：累加天干地支的五行属性
4. **百分比计算**：五行分布的可视化展示

### 性能优化

- 使用 `useState` 缓存解析后的数据
- 条件渲染避免不必要的计算
- 滚动视图优化长列表性能

### 错误处理

- JSON 解析失败时显示空状态
- 数据缺失时使用默认值
- 索引越界时返回"未知"

## 扩展功能建议

1. **大运流年**：添加未来运势预测
2. **神煞分析**：桃花、驿马、天乙贵人等
3. **格局判断**：从格、化格、专旺格等
4. **用神喜忌**：分析喜用神和忌神
5. **婚配分析**：与其他八字的合婚分析
6. **起名建议**：根据五行缺失推荐名字
7. **分享功能**：生成命盘图片分享
8. **收藏功能**：保存常用的命盘

## 相关文档

- [八字排盘主页面](../app/divination/bazi.tsx)
- [八字数据结构说明](./BAZI_RESULT_STRUCTURE.md)
- [命理服务实现](../src/services/divination.service.ts)
