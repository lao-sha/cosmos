# Pallet Affiliate å åœä¸“ç”¨æ”¹é€ æ–¹æ¡ˆ

**ç‰ˆæœ¬**: v1.0  
**æ—¥æœŸ**: 2025-12-31  
**çŠ¶æ€**: è®¾è®¡é˜¶æ®µ  
**ç›®æ ‡**: å°†é€šç”¨è”ç›Ÿè®¡é…¬ç³»ç»Ÿæ”¹é€ ä¸ºå åœä¸šåŠ¡ä¸“ç”¨çš„è®¡é…¬ç³»ç»Ÿ

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

å½“å‰çš„ `pallet-affiliate` æ˜¯ä¸€ä¸ªé€šç”¨çš„è”ç›Ÿè®¡é…¬ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§ä¸šåŠ¡åœºæ™¯ï¼ˆä¼šå‘˜è´­ä¹°ã€ä¾›å¥‰ã€äº¤æ˜“ç­‰ï¼‰ã€‚æœ¬æ–¹æ¡ˆå°†å…¶æ”¹é€ ä¸º**å åœä¸šåŠ¡ä¸“ç”¨**çš„è®¡é…¬ç³»ç»Ÿï¼Œèšç„¦äºå åœæœåŠ¡çš„ç‰¹æ®Šéœ€æ±‚ã€‚

### æ ¸å¿ƒæ”¹é€ ç›®æ ‡

1. âœ… **ä¸šåŠ¡èšç„¦** - ä¸“æ³¨äºå åœæœåŠ¡è®¡é…¬ï¼Œç§»é™¤æ— å…³åŠŸèƒ½
2. âœ… **å åœç±»å‹é€‚é…** - æ”¯æŒä¸åŒå åœç±»å‹çš„å·®å¼‚åŒ–è®¡é…¬
3. âœ… **éšç§æ¨¡å¼é›†æˆ** - ä¸å åœéšç§æ¨¡å¼æ·±åº¦é›†æˆ
4. âœ… **ç®€åŒ–æ¶æ„** - ç§»é™¤å¤æ‚çš„æ²»ç†å’Œå‘¨ç»“ç®—ï¼Œé‡‡ç”¨å³æ—¶åˆ†æˆ
5. âœ… **é™ä½ç»´æŠ¤æˆæœ¬** - ç²¾ç®€ä»£ç ï¼Œæé«˜å¯ç»´æŠ¤æ€§

---

## ğŸ¯ å åœä¸šåŠ¡ç‰¹ç‚¹åˆ†æ

### å åœæœåŠ¡çš„ç‹¬ç‰¹æ€§

| ç‰¹ç‚¹ | è¯´æ˜ | å¯¹è®¡é…¬çš„å½±å“ |
|------|------|-------------|
| **æœåŠ¡ç±»å‹å¤šæ ·** | å¥‡é—¨ã€ç´«å¾®ã€å…­çˆ»ã€æ¢…èŠ±ã€å¡”ç½—ç­‰ | éœ€è¦æ”¯æŒä¸åŒç±»å‹çš„å·®å¼‚åŒ–è®¡é…¬ |
| **ä»·æ ¼å·®å¼‚å¤§** | å…è´¹é¢„è§ˆ â†’ ä»˜è´¹è§£ç›˜ â†’ é«˜çº§å’¨è¯¢ | ä¸åŒä»·æ ¼æ¡£ä½çš„åˆ†æˆæ¯”ä¾‹å¯èƒ½ä¸åŒ |
| **éšç§æ•æ„Ÿ** | Public/Partial/Private ä¸‰ç§æ¨¡å¼ | éšç§æ¨¡å¼å¯èƒ½å½±å“è®¡é…¬ç­–ç•¥ |
| **å³æ—¶æ€§å¼º** | ç”¨æˆ·ä»˜è´¹åç«‹å³è·å¾—æœåŠ¡ | é€‚åˆå³æ—¶åˆ†æˆï¼Œä¸é€‚åˆå‘¨ç»“ç®— |
| **æ— ä¾›å¥‰æ—¶é•¿** | å åœæ˜¯ä¸€æ¬¡æ€§æœåŠ¡ | ä¸éœ€è¦æ´»è·ƒæœŸç®¡ç† |
| **æ— ä¼šå‘˜ä½“ç³»** | å åœæœåŠ¡ç‹¬ç«‹äºä¼šå‘˜ç³»ç»Ÿ | ä¸éœ€è¦ä¼šå‘˜ä¸“ç”¨åˆ†é…é€»è¾‘ |

### å½“å‰ç³»ç»Ÿçš„å†—ä½™åŠŸèƒ½

| åŠŸèƒ½æ¨¡å— | å½“å‰ç”¨é€” | å åœä¸šåŠ¡æ˜¯å¦éœ€è¦ | å¤„ç†æ–¹æ¡ˆ |
|---------|---------|-----------------|---------|
| **å‘¨ç»“ç®—** | æ‰¹é‡ç»“ç®—ï¼ŒèŠ‚çœGas | âŒ ä¸éœ€è¦ | ç§»é™¤ |
| **æ··åˆæ¨¡å¼** | å‰Nå±‚å³æ—¶ï¼ŒåMå±‚å‘¨ç»“ç®— | âŒ ä¸éœ€è¦ | ç§»é™¤ |
| **æ´»è·ƒæœŸç®¡ç†** | ä¾›å¥‰æ—¶é•¿ç®¡ç† | âŒ ä¸éœ€è¦ | ç§»é™¤ |
| **ç›´æ¨æ´»è·ƒæ•°** | åŠ¨æ€å±‚æ•°è°ƒæ•´ | âŒ ä¸éœ€è¦ | ç§»é™¤ |
| **ä¼šå‘˜ä¸“ç”¨åˆ†é…** | ä¼šå‘˜è´¹100%åˆ†é… | âŒ ä¸éœ€è¦ | ç§»é™¤ |
| **ç³»ç»Ÿè´¹ç”¨æ‰£é™¤** | é”€æ¯/å›½åº“/å­˜å‚¨ | âš ï¸ å¯é€‰ | ç®€åŒ–ä¸ºå¯é…ç½® |
| **æ²»ç†ç³»ç»Ÿ** | å…¨æ°‘æŠ•ç¥¨ä¿®æ”¹æ¯”ä¾‹ | âŒ è¿‡äºå¤æ‚ | ç§»é™¤ï¼Œæ”¹ä¸ºç®¡ç†å‘˜é…ç½® |
| **å¹´è´¹ä»·æ ¼æ²»ç†** | ä¼šå‘˜å¹´è´¹æŠ•ç¥¨ | âŒ ä¸éœ€è¦ | ç§»é™¤ |

---

## ğŸ”§ æ”¹é€ æ–¹æ¡ˆè®¾è®¡

### æ–¹æ¡ˆä¸€ï¼šç²¾ç®€æ”¹é€ ï¼ˆæ¨èï¼‰â­

**æ ¸å¿ƒæ€è·¯**ï¼šä¿ç•™æ¨èå…³ç³»å’Œå³æ—¶åˆ†æˆï¼Œç§»é™¤æ‰€æœ‰å†—ä½™åŠŸèƒ½ã€‚

#### ä¿ç•™çš„åŠŸèƒ½

1. **æ¨èå…³ç³»ç®¡ç†**ï¼ˆreferral palletï¼‰
   - æ¨èäººç»‘å®š
   - æ¨èç ç®¡ç†
   - æ¨èé“¾æŸ¥è¯¢ï¼ˆ15å±‚ï¼‰

2. **å³æ—¶åˆ†æˆ**ï¼ˆinstant.rsï¼‰
   - å®æ—¶è½¬è´¦
   - ç«‹å³åˆ°è´¦
   - 15å±‚åˆ†æˆ

3. **èµ„é‡‘æ‰˜ç®¡**ï¼ˆescrow.rsï¼‰
   - ç‹¬ç«‹æ‰˜ç®¡è´¦æˆ·
   - èµ„é‡‘å­˜å–

4. **é…ç½®ç®¡ç†**ï¼ˆç®€åŒ–ç‰ˆï¼‰
   - å åœç±»å‹åˆ†æˆæ¯”ä¾‹é…ç½®
   - ä»·æ ¼æ¡£ä½åˆ†æˆæ¯”ä¾‹é…ç½®

#### ç§»é™¤çš„åŠŸèƒ½

1. âŒ å‘¨ç»“ç®—æ¨¡å—ï¼ˆweekly.rsï¼‰
2. âŒ æ··åˆæ¨¡å¼
3. âŒ æ´»è·ƒæœŸç®¡ç†
4. âŒ ç›´æ¨æ´»è·ƒæ•°ç»Ÿè®¡
5. âŒ ä¼šå‘˜ä¸“ç”¨åˆ†é…
6. âŒ æ²»ç†ç³»ç»Ÿï¼ˆgovernance.rsï¼‰
7. âŒ å¹´è´¹ä»·æ ¼æ²»ç†

#### æ–°å¢çš„åŠŸèƒ½

1. âœ… **å åœç±»å‹é…ç½®**
   - æ¯ç§å åœç±»å‹ç‹¬ç«‹çš„åˆ†æˆæ¯”ä¾‹
   - æ”¯æŒåŠ¨æ€æ·»åŠ æ–°å åœç±»å‹

2. âœ… **ä»·æ ¼æ¡£ä½é…ç½®**
   - ä¸åŒä»·æ ¼åŒºé—´çš„å·®å¼‚åŒ–åˆ†æˆ
   - ä¾‹å¦‚ï¼š0-10 DUSTï¼ˆ5å±‚ï¼‰ï¼Œ10-100 DUSTï¼ˆ10å±‚ï¼‰ï¼Œ100+ DUSTï¼ˆ15å±‚ï¼‰

3. âœ… **éšç§æ¨¡å¼é›†æˆ**
   - Public æ¨¡å¼ï¼šæ ‡å‡†åˆ†æˆ
   - Partial æ¨¡å¼ï¼šæ ‡å‡†åˆ†æˆ
   - Private æ¨¡å¼ï¼šå¯é€‰æ›´é«˜åˆ†æˆï¼ˆæ¿€åŠ±éšç§ä¿æŠ¤ï¼‰

4. âœ… **å åœæœåŠ¡åˆ†é…æ¥å£**
   - ä¸“é—¨ä¸ºå åœæœåŠ¡è®¾è®¡çš„åˆ†é…æ¥å£
   - è‡ªåŠ¨è¯†åˆ«å åœç±»å‹å’Œä»·æ ¼æ¡£ä½

---

## ğŸ“¦ æ–°çš„æ•°æ®ç»“æ„è®¾è®¡

### å åœç±»å‹æšä¸¾

```rust
/// å åœç±»å‹
#[derive(Encode, Decode, Clone, Copy, PartialEq, Eq, TypeInfo, MaxEncodedLen, Debug)]
pub enum DivinationType {
    Qimen = 0,      // å¥‡é—¨éç”²
    Ziwei = 1,      // ç´«å¾®æ–—æ•°
    Liuyao = 2,     // å…­çˆ»
    Xiaoliuren = 3, // å°å…­å£¬
    Daliuren = 4,   // å¤§å…­å£¬
    Meihua = 5,     // æ¢…èŠ±æ˜“æ•°
    Tarot = 6,      // å¡”ç½—ç‰Œ
    Bazi = 7,       // å…«å­—
}
```

### å åœåˆ†æˆé…ç½®

```rust
/// å åœåˆ†æˆé…ç½®
#[derive(Encode, Decode, Clone, PartialEq, Eq, TypeInfo, MaxEncodedLen, Debug)]
pub struct DivinationRewardConfig {
    /// å åœç±»å‹
    pub divination_type: DivinationType,
    
    /// åŸºç¡€åˆ†æˆæ¯”ä¾‹ï¼ˆ15å±‚ï¼‰
    pub base_percents: LevelPercents,
    
    /// æ˜¯å¦å¯ç”¨ä»·æ ¼æ¡£ä½
    pub enable_price_tiers: bool,
    
    /// ä»·æ ¼æ¡£ä½é…ç½®ï¼ˆå¯é€‰ï¼‰
    pub price_tiers: Option<BoundedVec<PriceTier, ConstU32<5>>>,
    
    /// éšç§æ¨¡å¼åŠ æˆï¼ˆå¯é€‰ï¼‰
    pub privacy_bonus: Option<PrivacyBonus>,
}

/// ä»·æ ¼æ¡£ä½
#[derive(Encode, Decode, Clone, PartialEq, Eq, TypeInfo, MaxEncodedLen, Debug)]
pub struct PriceTier {
    /// æœ€ä½ä»·æ ¼ï¼ˆåŒ…å«ï¼‰
    pub min_price: Balance,
    
    /// æœ€é«˜ä»·æ ¼ï¼ˆä¸åŒ…å«ï¼Œ0è¡¨ç¤ºæ— ä¸Šé™ï¼‰
    pub max_price: Balance,
    
    /// åˆ†é…å±‚æ•°ï¼ˆ1-15ï¼‰
    pub levels: u8,
    
    /// åˆ†æˆæ¯”ä¾‹ï¼ˆå¯é€‰ï¼Œä¸è®¾ç½®åˆ™ä½¿ç”¨base_percentsï¼‰
    pub percents: Option<LevelPercents>,
}

/// éšç§æ¨¡å¼åŠ æˆ
#[derive(Encode, Decode, Clone, PartialEq, Eq, TypeInfo, MaxEncodedLen, Debug)]
pub struct PrivacyBonus {
    /// Private æ¨¡å¼é¢å¤–åŠ æˆï¼ˆç™¾åˆ†æ¯”ï¼Œ0-50ï¼‰
    pub private_bonus: u8,
    
    /// Partial æ¨¡å¼é¢å¤–åŠ æˆï¼ˆç™¾åˆ†æ¯”ï¼Œ0-20ï¼‰
    pub partial_bonus: u8,
}
```

### å­˜å‚¨é¡¹è®¾è®¡

```rust
// === å åœé…ç½®å­˜å‚¨ ===

/// å åœç±»å‹åˆ†æˆé…ç½®
#[pallet::storage]
pub type DivinationConfigs<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    DivinationType,
    DivinationRewardConfig,
    ValueQuery,
    DefaultDivinationConfig,
>;

/// ç³»ç»Ÿè´¹ç”¨é…ç½®ï¼ˆå¯é€‰ï¼‰
#[pallet::storage]
pub type SystemFeeConfig<T: Config> = StorageValue<
    _,
    SystemFees,
    ValueQuery,
    DefaultSystemFees,
>;

/// ç³»ç»Ÿè´¹ç”¨ç»“æ„
#[derive(Encode, Decode, Clone, PartialEq, Eq, TypeInfo, MaxEncodedLen, Debug)]
pub struct SystemFees {
    /// é”€æ¯æ¯”ä¾‹ï¼ˆ0-100ï¼‰
    pub burn_percent: u8,
    
    /// å›½åº“æ¯”ä¾‹ï¼ˆ0-100ï¼‰
    pub treasury_percent: u8,
    
    /// å­˜å‚¨æ¯”ä¾‹ï¼ˆ0-100ï¼‰
    pub storage_percent: u8,
    
    /// æ˜¯å¦å¯ç”¨ç³»ç»Ÿè´¹ç”¨
    pub enabled: bool,
}
```

---

## ğŸ”Œ æ–°çš„æ¥å£è®¾è®¡

### æ ¸å¿ƒåˆ†é…æ¥å£

```rust
/// å åœæœåŠ¡åˆ†é…æ¥å£
/// 
/// å‚æ•°ï¼š
/// - buyer: è´­ä¹°è€…ï¼ˆå åœç”¨æˆ·ï¼‰
/// - divination_type: å åœç±»å‹
/// - amount: æ”¯ä»˜é‡‘é¢
/// - privacy_mode: éšç§æ¨¡å¼ï¼ˆ0=Public, 1=Partial, 2=Privateï¼‰
/// 
/// è¿”å›ï¼šå®é™…åˆ†é…æ€»é¢
#[pallet::call_index(20)]
#[pallet::weight(10_000)]
pub fn distribute_divination_rewards(
    origin: OriginFor<T>,
    buyer: T::AccountId,
    divination_type: DivinationType,
    amount: BalanceOf<T>,
    privacy_mode: u8,
) -> DispatchResult {
    T::AdminOrigin::ensure_origin(origin)?;
    
    let distributed = Self::do_distribute_divination_rewards(
        &buyer,
        divination_type,
        amount,
        privacy_mode,
    )?;
    
    Self::deposit_event(Event::DivinationRewardDistributed {
        buyer,
        divination_type,
        amount,
        distributed,
    });
    
    Ok(())
}
```

### é…ç½®ç®¡ç†æ¥å£

```rust
/// è®¾ç½®å åœç±»å‹åˆ†æˆé…ç½®
#[pallet::call_index(21)]
#[pallet::weight(10_000)]
pub fn set_divination_config(
    origin: OriginFor<T>,
    divination_type: DivinationType,
    config: DivinationRewardConfig,
) -> DispatchResult {
    T::AdminOrigin::ensure_origin(origin)?;
    
    // éªŒè¯é…ç½®æœ‰æ•ˆæ€§
    Self::validate_divination_config(&config)?;
    
    DivinationConfigs::<T>::insert(divination_type, config);
    
    Self::deposit_event(Event::DivinationConfigUpdated {
        divination_type,
    });
    
    Ok(())
}

/// è®¾ç½®ç³»ç»Ÿè´¹ç”¨é…ç½®
#[pallet::call_index(22)]
#[pallet::weight(10_000)]
pub fn set_system_fees(
    origin: OriginFor<T>,
    fees: SystemFees,
) -> DispatchResult {
    T::AdminOrigin::ensure_origin(origin)?;
    
    // éªŒè¯æ€»æ¯”ä¾‹ä¸è¶…è¿‡100%
    ensure!(
        fees.burn_percent + fees.treasury_percent + fees.storage_percent <= 100,
        Error::<T>::InvalidSystemFees
    );
    
    SystemFeeConfig::<T>::put(fees);
    
    Self::deposit_event(Event::SystemFeesUpdated);
    
    Ok(())
}
```

---

## ğŸ¨ åˆ†é…é€»è¾‘å®ç°

### æ ¸å¿ƒåˆ†é…æµç¨‹

```rust
impl<T: Config> Pallet<T> {
    /// å åœæœåŠ¡åˆ†é…å®ç°
    pub fn do_distribute_divination_rewards(
        buyer: &T::AccountId,
        divination_type: DivinationType,
        gross_amount: BalanceOf<T>,
        privacy_mode: u8,
    ) -> Result<BalanceOf<T>, DispatchError> {
        if gross_amount.is_zero() {
            return Ok(BalanceOf::<T>::zero());
        }
        
        // 1. è·å–å åœé…ç½®
        let config = DivinationConfigs::<T>::get(divination_type);
        
        // 2. æ‰£é™¤ç³»ç»Ÿè´¹ç”¨ï¼ˆå¦‚æœå¯ç”¨ï¼‰
        let distributable = Self::deduct_system_fees_if_enabled(buyer, gross_amount)?;
        
        // 3. ç¡®å®šåˆ†é…å±‚æ•°å’Œæ¯”ä¾‹
        let (levels, percents) = Self::determine_distribution_params(
            &config,
            distributable,
            privacy_mode,
        );
        
        // 4. æ‰§è¡Œå³æ—¶åˆ†æˆ
        let distributed = Self::do_instant_distribute_with_config(
            buyer,
            distributable,
            levels,
            &percents,
        );
        
        Ok(distributed)
    }
    
    /// ç¡®å®šåˆ†é…å‚æ•°ï¼ˆå±‚æ•°å’Œæ¯”ä¾‹ï¼‰
    fn determine_distribution_params(
        config: &DivinationRewardConfig,
        amount: BalanceOf<T>,
        privacy_mode: u8,
    ) -> (u8, LevelPercents) {
        let mut levels = 15u8;
        let mut percents = config.base_percents.clone();
        
        // 1. æ ¹æ®ä»·æ ¼æ¡£ä½è°ƒæ•´
        if config.enable_price_tiers {
            if let Some(tiers) = &config.price_tiers {
                for tier in tiers.iter() {
                    if amount >= tier.min_price.into() 
                        && (tier.max_price == 0 || amount < tier.max_price.into()) 
                    {
                        levels = tier.levels;
                        if let Some(tier_percents) = &tier.percents {
                            percents = tier_percents.clone();
                        }
                        break;
                    }
                }
            }
        }
        
        // 2. æ ¹æ®éšç§æ¨¡å¼åŠ æˆ
        if let Some(bonus) = &config.privacy_bonus {
            let bonus_percent = match privacy_mode {
                2 => bonus.private_bonus,  // Private
                1 => bonus.partial_bonus,  // Partial
                _ => 0,                    // Public
            };
            
            if bonus_percent > 0 {
                percents = Self::apply_bonus(&percents, bonus_percent);
            }
        }
        
        (levels, percents)
    }
    
    /// åº”ç”¨åŠ æˆ
    fn apply_bonus(percents: &LevelPercents, bonus: u8) -> LevelPercents {
        let mut result = percents.clone();
        for percent in result.iter_mut() {
            let bonus_amount = (*percent as u16 * bonus as u16) / 100;
            *percent = (*percent as u16 + bonus_amount).min(100) as u8;
        }
        result
    }
}
```

---

## ğŸ“Š é»˜è®¤é…ç½®ç¤ºä¾‹

### å¥‡é—¨éç”²é…ç½®

```rust
DivinationRewardConfig {
    divination_type: DivinationType::Qimen,
    base_percents: vec![30, 25, 15, 10, 7, 3, 2, 2, 2, 1, 1, 1, 1, 1, 1],
    enable_price_tiers: true,
    price_tiers: Some(vec![
        PriceTier {
            min_price: 0,
            max_price: 10_000_000_000_000,  // 10 DUST
            levels: 5,
            percents: Some(vec![40, 30, 20, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]),
        },
        PriceTier {
            min_price: 10_000_000_000_000,
            max_price: 100_000_000_000_000,  // 100 DUST
            levels: 10,
            percents: None,  // ä½¿ç”¨ base_percents
        },
        PriceTier {
            min_price: 100_000_000_000_000,
            max_price: 0,  // æ— ä¸Šé™
            levels: 15,
            percents: None,
        },
    ]),
    privacy_bonus: Some(PrivacyBonus {
        private_bonus: 20,  // Private æ¨¡å¼é¢å¤– 20%
        partial_bonus: 10,  // Partial æ¨¡å¼é¢å¤– 10%
    }),
}
```

### å¡”ç½—ç‰Œé…ç½®ï¼ˆç®€åŒ–ç‰ˆï¼‰

```rust
DivinationRewardConfig {
    divination_type: DivinationType::Tarot,
    base_percents: vec![25, 20, 15, 10, 8, 5, 3, 3, 2, 2, 1, 1, 1, 1, 1],
    enable_price_tiers: false,  // ä¸å¯ç”¨ä»·æ ¼æ¡£ä½
    price_tiers: None,
    privacy_bonus: None,  // ä¸å¯ç”¨éšç§åŠ æˆ
}
```

---

## ğŸ”„ è¿ç§»æ­¥éª¤

### Phase 1: ä»£ç ç²¾ç®€ï¼ˆ2å¤©ï¼‰

1. **ç§»é™¤å†—ä½™æ¨¡å—**
   - [ ] åˆ é™¤ `weekly.rs`
   - [ ] åˆ é™¤ `governance.rs`
   - [ ] åˆ é™¤ `lib.rs` ä¸­çš„æ²»ç†ç›¸å…³å­˜å‚¨å’Œæ¥å£
   - [ ] åˆ é™¤ `types.rs` ä¸­çš„ `SettlementMode::Weekly` å’Œ `Hybrid`

2. **ç®€åŒ– distribute.rs**
   - [ ] ç§»é™¤ `do_distribute_rewards`ï¼ˆé€šç”¨åˆ†é…ï¼‰
   - [ ] ç§»é™¤ `do_distribute_membership_rewards`ï¼ˆä¼šå‘˜åˆ†é…ï¼‰
   - [ ] ç§»é™¤ `distribute_by_mode`ï¼ˆæ¨¡å¼è·¯ç”±ï¼‰
   - [ ] ä¿ç•™ `deduct_system_fees`ï¼Œæ”¹ä¸ºå¯é€‰

3. **ç®€åŒ– instant.rs**
   - [ ] ä¿ç•™æ ¸å¿ƒå³æ—¶åˆ†æˆé€»è¾‘
   - [ ] ç§»é™¤æ´»è·ƒæœŸç›¸å…³ä»£ç 

### Phase 2: æ–°åŠŸèƒ½å¼€å‘ï¼ˆ3å¤©ï¼‰

1. **å åœç±»å‹é…ç½®**
   - [ ] å®šä¹‰ `DivinationType` æšä¸¾
   - [ ] å®šä¹‰ `DivinationRewardConfig` ç»“æ„
   - [ ] å®šä¹‰ `PriceTier` å’Œ `PrivacyBonus` ç»“æ„
   - [ ] æ·»åŠ  `DivinationConfigs` å­˜å‚¨

2. **æ–°åˆ†é…æ¥å£**
   - [ ] å®ç° `distribute_divination_rewards`
   - [ ] å®ç° `do_distribute_divination_rewards`
   - [ ] å®ç° `determine_distribution_params`
   - [ ] å®ç° `apply_bonus`

3. **é…ç½®ç®¡ç†æ¥å£**
   - [ ] å®ç° `set_divination_config`
   - [ ] å®ç° `set_system_fees`
   - [ ] æ·»åŠ é…ç½®éªŒè¯é€»è¾‘

### Phase 3: é›†æˆæµ‹è¯•ï¼ˆ2å¤©ï¼‰

1. **å•å…ƒæµ‹è¯•**
   - [ ] æµ‹è¯•ä¸åŒå åœç±»å‹çš„åˆ†é…
   - [ ] æµ‹è¯•ä»·æ ¼æ¡£ä½é€»è¾‘
   - [ ] æµ‹è¯•éšç§æ¨¡å¼åŠ æˆ
   - [ ] æµ‹è¯•ç³»ç»Ÿè´¹ç”¨æ‰£é™¤

2. **é›†æˆæµ‹è¯•**
   - [ ] ä¸ Qimen æ¨¡å—é›†æˆæµ‹è¯•
   - [ ] ä¸ Ziwei æ¨¡å—é›†æˆæµ‹è¯•
   - [ ] ä¸ Privacy æ¨¡å—é›†æˆæµ‹è¯•

3. **æ–‡æ¡£æ›´æ–°**
   - [ ] æ›´æ–° README.md
   - [ ] æ·»åŠ é…ç½®ç¤ºä¾‹
   - [ ] æ·»åŠ å‰ç«¯è°ƒç”¨ç¤ºä¾‹

---

## ğŸ“ˆ æ”¹é€ æ•ˆæœå¯¹æ¯”

### ä»£ç é‡å¯¹æ¯”

| æ¨¡å— | æ”¹é€ å‰ | æ”¹é€ å | å‡å°‘ |
|------|--------|--------|------|
| lib.rs | 1656 è¡Œ | ~800 è¡Œ | -52% |
| weekly.rs | ~300 è¡Œ | 0 è¡Œ | -100% |
| governance.rs | ~500 è¡Œ | 0 è¡Œ | -100% |
| distribute.rs | ~150 è¡Œ | ~200 è¡Œ | +33% |
| types.rs | ~100 è¡Œ | ~200 è¡Œ | +100% |
| **æ€»è®¡** | ~2700 è¡Œ | ~1200 è¡Œ | **-56%** |

### åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | æ”¹é€ å‰ | æ”¹é€ å |
|------|--------|--------|
| ç»“ç®—æ¨¡å¼ | 3ç§ï¼ˆWeekly/Instant/Hybridï¼‰ | 1ç§ï¼ˆInstantï¼‰ |
| é…ç½®ç®¡ç† | æ²»ç†æŠ•ç¥¨ | ç®¡ç†å‘˜é…ç½® |
| å åœç±»å‹æ”¯æŒ | æ—  | 8ç§ï¼ˆå¯æ‰©å±•ï¼‰ |
| ä»·æ ¼æ¡£ä½ | æ—  | æ”¯æŒ |
| éšç§æ¨¡å¼é›†æˆ | æ—  | æ”¯æŒ |
| ç»´æŠ¤å¤æ‚åº¦ | é«˜ | ä½ |

---

## ğŸš€ å‰ç«¯é›†æˆç¤ºä¾‹

### åˆ›å»ºå åœå¹¶åˆ†é…å¥–åŠ±

```typescript
// 1. ç”¨æˆ·åˆ›å»ºå åœï¼ˆä¾‹å¦‚å¥‡é—¨éç”²ï¼‰
const chartId = await api.tx.qimen
  .createChartEncrypted(
    solarYear,
    solarMonth,
    solarDay,
    solarHour,
    solarMinute,
    1  // PrivacyMode::Partial
  )
  .signAndSend(user);

// 2. ç”¨æˆ·æ”¯ä»˜è§£ç›˜è´¹ç”¨ï¼ˆä¾‹å¦‚ 50 DUSTï¼‰
const amount = 50_000_000_000_000;  // 50 DUST

// 3. ç³»ç»Ÿè‡ªåŠ¨åˆ†é…è”ç›Ÿå¥–åŠ±
await api.tx.affiliate
  .distributeDivinationRewards(
    user.address,
    0,  // DivinationType::Qimen
    amount,
    1   // PrivacyMode::Partial
  )
  .signAndSend(adminAccount);
```

### æŸ¥è¯¢å åœé…ç½®

```typescript
// æŸ¥è¯¢å¥‡é—¨éç”²çš„åˆ†æˆé…ç½®
const config = await api.query.affiliate.divinationConfigs(0);  // Qimen

console.log('åŸºç¡€åˆ†æˆæ¯”ä¾‹:', config.basePercents.toJSON());
console.log('ä»·æ ¼æ¡£ä½:', config.priceTiers.toJSON());
console.log('éšç§åŠ æˆ:', config.privacyBonus.toJSON());
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å‘åå…¼å®¹æ€§

1. **æ¨èå…³ç³»æ•°æ®**ï¼šå®Œå…¨å…¼å®¹ï¼Œæ— éœ€è¿ç§»
2. **æ‰˜ç®¡è´¦æˆ·ä½™é¢**ï¼šå®Œå…¨å…¼å®¹ï¼Œæ— éœ€è¿ç§»
3. **å‘¨ç»“ç®—æ•°æ®**ï¼šéœ€è¦åœ¨ç§»é™¤å‰å®Œæˆæ‰€æœ‰å¾…ç»“ç®—å‘¨æœŸ
4. **æ²»ç†ææ¡ˆ**ï¼šéœ€è¦åœ¨ç§»é™¤å‰å®Œæˆæˆ–å–æ¶ˆæ‰€æœ‰æ´»è·ƒææ¡ˆ

### è¿ç§»é£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|----------|
| å‘¨ç»“ç®—æ•°æ®ä¸¢å¤± | é«˜ | è¿ç§»å‰å®Œæˆæ‰€æœ‰ç»“ç®— |
| æ²»ç†ææ¡ˆä¸­æ–­ | ä¸­ | æå‰å…¬å‘Šï¼Œå®Œæˆæˆ–å–æ¶ˆææ¡ˆ |
| å‰ç«¯è°ƒç”¨å¤±è´¥ | é«˜ | æä¾›å…¼å®¹å±‚æˆ–åŒæ­¥æ›´æ–°å‰ç«¯ |

---

## ğŸ“ æ€»ç»“

### æ”¹é€ ä¼˜åŠ¿

1. âœ… **ä»£ç é‡å‡å°‘ 56%**ï¼Œç»´æŠ¤æˆæœ¬å¤§å¹…é™ä½
2. âœ… **ä¸“æ³¨å åœä¸šåŠ¡**ï¼ŒåŠŸèƒ½æ›´åŠ ç²¾å‡†
3. âœ… **æ”¯æŒå·®å¼‚åŒ–è®¡é…¬**ï¼Œé€‚åº”ä¸åŒå åœç±»å‹
4. âœ… **éšç§æ¨¡å¼é›†æˆ**ï¼Œæ¿€åŠ±ç”¨æˆ·ä½¿ç”¨éšç§ä¿æŠ¤
5. âœ… **å³æ—¶åˆ†æˆ**ï¼Œç”¨æˆ·ä½“éªŒæ›´å¥½

### æ¨èå®æ–½

**æ¨èé‡‡ç”¨æ–¹æ¡ˆä¸€ï¼ˆç²¾ç®€æ”¹é€ ï¼‰**ï¼Œç†ç”±ï¼š
- å åœä¸šåŠ¡ç‰¹ç‚¹å†³å®šäº†ä¸éœ€è¦å¤æ‚çš„å‘¨ç»“ç®—å’Œæ²»ç†
- å³æ—¶åˆ†æˆæ›´ç¬¦åˆå åœæœåŠ¡çš„å³æ—¶æ€§ç‰¹ç‚¹
- ä»£ç ç²¾ç®€åæ›´æ˜“ç»´æŠ¤å’Œæ‰©å±•
- å·®å¼‚åŒ–é…ç½®æ»¡è¶³ä¸åŒå åœç±»å‹çš„éœ€æ±‚

---

**ç»´æŠ¤è€…**: Stardust Team  
**æœ€åæ›´æ–°**: 2025-12-31  
**ç‰ˆæœ¬**: v1.0

